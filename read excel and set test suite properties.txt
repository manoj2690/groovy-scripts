import java.io.File;
import java.io.FileInputStream;
import java.io.FileNotFoundException;
import java.io.FileOutputStream;
import java.io.IOException;
import com.eviware.soapui.support.*;
import java.util.*;
import jxl.*;
import java.lang.*;
import jxl.*
import jxl.write.*
import org.apache.poi.hssf.usermodel.HSSFCell;
import org.apache.poi.hssf.usermodel.HSSFCellStyle;
import org.apache.poi.hssf.usermodel.HSSFFont;
import org.apache.poi.hssf.usermodel.HSSFRow;
import org.apache.poi.hssf.usermodel.HSSFSheet;
import org.apache.poi.hssf.usermodel.HSSFWorkbook;
import org.apache.poi.hssf.util.HSSFColor;
import com.eviware.soapui.model.project.ProjectFactoryRegistry
import com.eviware.soapui.impl.wsdl.WsdlProjectFactory

def Test_Execution_Data_excel_path = com.eviware.soapui.SoapUI.globalProperties.getPropertyValue( "Test_Execution_Data_excel_path" )
log.info("Test Execution Data path = "+Test_Execution_Data_excel_path)

def dataFile =  Test_Execution_Data_excel_path +"Test_Execution_Data.xls";
FileInputStream fileInputStream = new FileInputStream(new File (dataFile));
HSSFWorkbook testExeDataWB = new HSSFWorkbook(fileInputStream);
HSSFSheet runModeWS = testExeDataWB.getSheet("Run Mode");
HSSFRow runmode_row = runModeWS.getRow(1);
runmode =  runmode_row.getCell((short) 0).getNumericCellValue();

// loads the url dynamically based on runmode from excel

	def uri_value = " "

	if ( runmode == 1.0 ){
		uri_value = runmode_row.getCell((short) 1).getStringCellValue();
		log.info("Using API_TestLab URL : " +uri_value)
	}

	else if( runmode == 2.0){
    		uri_value = runmode_row.getCell((short) 2).getStringCellValue();
    		log.info("Using SandBox URL : " +uri_value)
	}

	else {
		uri_value = runmode_row.getCell((short) 3).getStringCellValue();
		log.info("Using FT URL : " +uri_value)
	}

HSSFSheet TED_worksheet = testExeDataWB.getSheet("Projects");
int rows = TED_worksheet.getPhysicalNumberOfRows();
int cols = TED_worksheet.getRow(0).getLastCellNum();

 def data = new Object [rows][cols];

for (int i = 1; i < rows; i++) {

	for (int j = 0; j<cols; j++){

		data[i-1][j] = TED_worksheet.getRow(i).getCell(j).getStringCellValue();
		log.info data[i-1][j]

		
	}
	

}

for (int i = 1; i < rows; i++) {
testRunner.testCase.testSuite.setPropertyValue( "Project", data[i-1][0] )
testRunner.testCase.testSuite.setPropertyValue( "Data Centre", data[i-1][1] )
testRunner.testCase.testSuite.setPropertyValue( "Get data", data[i-1][2] )
testRunner.testCase.testSuite.setPropertyValue( "Execute", data[i-1][3] )
}
